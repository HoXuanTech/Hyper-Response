<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>ç´…ç¶ ç‡ˆåæ‡‰éŠæˆ²ï¼ˆå«æŒ‘æˆ°ç´šï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: "Noto Sans TC", system-ui, -apple-system, sans-serif;
           background:#0f1115; color:#e9eef6; margin:0; padding:40px 20px; }
    .wrap{ max-width:720px; margin:0 auto; background:#171922; border:1px solid rgba(255,255,255,.08);
           border-radius:20px; padding:24px; box-shadow:0 20px 40px rgba(0,0,0,.45);}
    h1{ margin:0 0 8px; font-size:26px }
    p{ margin:6px 0; color:#9aa7b2}
    .topbar{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:8px}
    select, button{ font-size:16px; border-radius:12px; border:1px solid rgba(255,255,255,.12);
                    background:#1c2130; color:#e9eef6; padding:10px 14px; }
    button{ cursor:pointer; background:linear-gradient(135deg,#3b82f6,#8b5cf6); border:none;
            box-shadow:0 10px 20px rgba(59,130,246,.25); transition:transform .06s, filter .2s}
    button:hover{ filter:brightness(1.05) } button:active{ transform:translateY(1px) scale(.99) }
    .arena{ margin:18px 0 10px; display:grid; place-items:center; height:320px; border-radius:18px;
            background:#2a2f3a; user-select:none; }
    .light{ width:160px; height:160px; border-radius:50%; box-shadow:inset 0 0 30px rgba(0,0,0,.5);
            transition: background .15s, box-shadow .15s }
    .red{ background:#e53935; box-shadow:0 0 30px rgba(229,57,53,.65), inset 0 0 30px rgba(0,0,0,.5) }
    .yellow{ background:#fbbf24; box-shadow:0 0 30px rgba(251,191,36,.6), inset 0 0 30px rgba(0,0,0,.5) }
    .green{ background:#22c55e; box-shadow:0 0 30px rgba(34,197,94,.6), inset 0 0 30px rgba(0,0,0,.5) }
    .hint{ margin-top:14px; font-weight:700; font-size:18px }
    #result{ margin-top:8px; font-size:18px }
    /* çŠ¯è¦é¬¼è‡‰ */
    #demonFace{
      position:fixed; top:50%; left:50%; transform:translate(-50%,-50%) scale(.85);
      width:220px; max-width:45vw; opacity:0; pointer-events:none; z-index:99;
      filter:drop-shadow(0 0 16px rgba(229,57,53,.9)) saturate(1.1);
      transition:opacity .18s ease, transform .18s ease;
    }
    .show-demon{ opacity:1 !important; animation:shake .3s infinite; transform:translate(-50%,-50%) scale(1); }
    @keyframes shake{
      0%,100%{ transform:translate(-50%,-50%) scale(1) rotate(0deg); }
      25%{ transform:translate(-50%,-50%) scale(1.02) rotate(8deg); }
      50%{ transform:translate(-50%,-50%) scale(1) rotate(-8deg); }
      75%{ transform:translate(-50%,-50%) scale(1.02) rotate(6deg); }
    }
    .muted{ color:#9aa7b2 }
  </style>
</head>
<body>
  <!-- çŠ¯è¦é¬¼è‡‰ï¼ˆè«‹åœ¨ repo æ”¾ demon.png èˆ‡æœ¬æª”åŒå±¤ï¼‰ -->
  <img id="demonFace" src="demon.png" alt="çŠ¯è¦ï¼"/>

  <div class="wrap">
    <h1>ç´…ç¶ ç‡ˆåæ‡‰éŠæˆ² ğŸš¦</h1>
    <p>åªæœ‰<strong>ç¶ ç‡ˆ</strong>å¯ä»¥æŒ‰ã€‚ç´…ç‡ˆæˆ–é»ƒç‡ˆæŒ‰ä¸‹æœƒè¢«é¬¼è‡‰æŒ‡è²¬ ğŸ‘¹</p>

    <div class="topbar">
      <label>ç­‰ç´šï¼š
        <select id="level">
          <option value="normal">ä¸€èˆ¬</option>
          <option value="challenge">æŒ‘æˆ°ç´šï¼ˆå¯èƒ½å…ˆäº®é»ƒç‡ˆï¼‰</option>
        </select>
      </label>
      <button id="startBtn">é–‹å§‹</button>
      <button id="tapBtn">æˆ‘æŒ‰äº†ï¼</button>
      <span id="status" class="muted"></span>
    </div>

    <div class="arena" id="arena">
      <div id="light" class="light red"></div>
      <div class="hint" id="hint">æŒ‰ã€Œé–‹å§‹ã€æº–å‚™</div>
    </div>

    <div id="result"></div>
    <p class="muted">å°æŠ€å·§ï¼šæŒ‘æˆ°ç´šæœƒéš¨æ©Ÿå‡ºç¾é»ƒç‡ˆ 0.3â€“0.8 ç§’ï¼Œåˆ¥è¢«é¨™äº†ï¼</p>
  </div>

<script>
(() => {
  const light = document.getElementById('light');
  const startBtn = document.getElementById('startBtn');
  const tapBtn = document.getElementById('tapBtn');
  const levelSel = document.getElementById('level');
  const hint = document.getElementById('hint');
  const result = document.getElementById('result');
  const statusEl = document.getElementById('status');
  const demonFace = document.getElementById('demonFace');

  let current = 'red';      // 'red' | 'yellow' | 'green'
  let startTime = 0;        // ç¶ ç‡ˆé–‹å§‹æ™‚é–“
  let timerA = null;        // è¨ˆæ™‚å™¨ï¼šç­‰ç¶ æˆ–é»ƒ
  let timerB = null;        // è¨ˆæ™‚å™¨ï¼šé»ƒè½‰ç¶ 
  let playing = false;

  const AC = window.AudioContext || window.webkitAudioContext;
  const audioCtx = new AC();
  const now = () => audioCtx.currentTime;
  function beep(freq=880, dur=0.08, type='sine', gain=0.08){
    const t0 = now(); const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
    o.type = type; o.frequency.setValueAtTime(freq, t0);
    g.gain.setValueAtTime(0, t0); g.gain.linearRampToValueAtTime(gain, t0 + 0.005);
    g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);
    o.connect(g).connect(audioCtx.destination); o.start(t0); o.stop(t0 + dur + 0.02);
  }
  const sndReady = ()=>beep(1200,0.09,'triangle',0.10);
  const sndFoul  = ()=>beep(200, 0.12,'square',0.12);
  const sndGood  = ()=>{beep(900,0.06,'sine',0.08); beep(1200,0.06,'sine',0.08);};

  function setLight(color){
    current = color;
    light.className = 'light ' + color;
    if(color==='red')   hint.textContent = 'ç­‰å€™ä¸­â€¦ï¼ˆä¸è¦æŒ‰ï¼‰';
    if(color==='yellow')hint.textContent = 'å°å¿ƒï¼é‚„æ²’ç¶ ï¼';
    if(color==='green') hint.textContent = 'ç¾åœ¨ï¼å¿«æŒ‰ï¼';
  }

  function showDemon(){
    demonFace.classList.add('show-demon');
    setTimeout(()=>demonFace.classList.remove('show-demon'), 1500);
  }

  function reset(){
    clearTimeout(timerA); clearTimeout(timerB);
    timerA = timerB = null;
    playing = false;
    setLight('red');
    statusEl.textContent = '';
  }

  function startGame(){
    audioCtx.resume();
    reset();
    playing = true;
    result.textContent = '';
    statusEl.textContent = 'æº–å‚™â€¦';
    // éš¨æ©Ÿç­‰å¾…ï¼šä¸€èˆ¬ 1~2.5sï¼›æŒ‘æˆ°ç´š 1~3s
    const delay = (levelSel.value==='challenge')
      ? (1000 + Math.random()*2000)
      : (1000 + Math.random()*1500);

    timerA = setTimeout(()=>{
      if(levelSel.value==='challenge' && Math.random()<0.55){
        // å…ˆäº®é»ƒç‡ˆ 0.3~0.8s å†è½‰ç¶ 
        setLight('yellow');
        timerB = setTimeout(()=>{
          setLight('green'); sndReady();
          startTime = performance.now();
        }, 300 + Math.random()*500);
      }else{
        // ç›´æ¥ç¶ ç‡ˆ
        setLight('green'); sndReady();
        startTime = performance.now();
      }
    }, delay);
  }

  function foul(reason='çŠ¯è¦ï¼'){
    sndFoul();
    showDemon();
    result.textContent = reason + 'ï¼ˆåªèƒ½åœ¨ç¶ ç‡ˆæŒ‰ï¼‰';
    reset();
  }

  function handleTap(){
    audioCtx.resume();
    if(!playing){ result.textContent='è«‹å…ˆæŒ‰ã€Œé–‹å§‹ã€'; return; }
    if(current!=='green'){ return foul(current==='yellow' ? 'é»ƒç‡ˆæŒ‰ä¸‹' : 'å¤ªæ—©äº†'); }
    // åˆæ³•
    const rt = Math.round(performance.now() - startTime);
    sndGood();
    result.textContent = `ä½ çš„åæ‡‰æ™‚é–“ï¼š${rt} ms`;
    statusEl.textContent = 'åšå¾—å¥½ï¼å†ä¾†ä¸€å±€ï¼Ÿ';
    reset();
  }

  startBtn.addEventListener('click', startGame);
  tapBtn.addEventListener('click', handleTap);
  // ä¹Ÿå…è¨±ç›´æ¥é»ç‡ˆå€åŸŸ
  document.getElementById('arena').addEventListener('click', handleTap);
})();
</script>
</body>
</html>
